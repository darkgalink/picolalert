import{useAuthStore as y}from"./auth-store.whEsov_B.js";import"./api.yQKbUgAA.js";document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("login-form"),n=document.getElementById("error-message"),f=document.getElementById("error-text"),r=document.getElementById("success-message"),h=document.getElementById("success-text"),i=document.getElementById("login-button"),a=document.getElementById("login-text"),d=document.getElementById("login-loading");function c(o){f&&(f.textContent=o),n&&n.classList.remove("hidden"),r&&r.classList.add("hidden")}function L(o){h&&(h.textContent=o),r&&r.classList.remove("hidden"),n&&n.classList.add("hidden")}function p(){n&&n.classList.add("hidden"),r&&r.classList.add("hidden")}const l=new URLSearchParams(window.location.search).get("error");if(l){const o={session_expired:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",session_validation_failed:"No se pudo validar tu sesión. Por favor, inicia sesión nuevamente.",auth_store_not_found:"Error en el sistema de autenticación. Por favor, inicia sesión nuevamente.",auth_failed:"Error de autenticación. Por favor, verifica tus credenciales.",network_error:"Error de conexión con el servidor. Por favor, intenta más tarde."},u=l&&l in o?o[l]:"Ha ocurrido un error. Por favor, inicia sesión nuevamente.";c(u)}function s(o){o?(a&&a.classList.add("hidden"),d&&d.classList.remove("hidden"),i&&(i.disabled=!0)):(a&&a.classList.remove("hidden"),d&&d.classList.add("hidden"),i&&(i.disabled=!1))}m&&m.addEventListener("submit",async o=>{o.preventDefault(),console.log("Formulario de login enviado"),p(),s(!0);const u=new FormData(m),v=u.get("email"),w=u.get("password");console.log("Datos de login recopilados:",{email:v,password:"***OCULTA***"});let g;const x=new Promise(async e=>{try{console.log("Obteniendo instancia de authStore");const t=y.getState();console.log("Llamando a authStore.login");const E=await t.login(v,w);console.log("Resultado de login:",E),e(E)}catch(t){console.error("Error durante login:",t),e({success:!1,error:t instanceof Error?t.message:"Error inesperado durante el login"})}});g=setTimeout(()=>{console.error("Timeout durante el login"),s(!1),c("El proceso de login está tardando demasiado. Por favor, inténtelo de nuevo.")},2e4);try{const e=await x;clearTimeout(g),e.success?(console.log("Login exitoso, mostrando mensaje de éxito"),L("Inicio de sesión exitoso. Redirigiendo..."),console.log("Configurando redirección a dashboard"),setTimeout(()=>{console.log("Redirigiendo a dashboard"),window.location.href="/user/dashboard"},1500)):(console.error("Error en login:",e.error),c(typeof e.error=="string"?e.error:"Error al iniciar sesión"),s(!1))}catch(e){clearTimeout(g),console.error("Error inesperado durante login:",e),s(!1),e instanceof Error&&console.error("Detalles del error:",{mensaje:e.message,nombre:e.name,stack:e.stack}),c("Error de conexión. Por favor, intenta de nuevo.")}finally{console.log("Finalizando proceso de login"),s(!1)}})});
