import{useAuthStore as h}from"./auth-store.whEsov_B.js";import{i as p,b as f}from"./api.yQKbUgAA.js";document.addEventListener("DOMContentLoaded",async()=>{const l=h.getState();if(!l.isAuthenticated){window.location.href="/login";return}try{const t=await p();if(typeof t=="object"&&t!==null&&"isAuthenticated"in t&&!t.isAuthenticated){console.error("La sesión de Directus ha expirado"),l.logout(),window.location.href="/login?session=expired";return}}catch(t){console.error("Error al verificar autenticación:",t)}const i=document.getElementById("vehicle-form"),s=document.getElementById("submit-btn"),d=document.getElementById("submit-spinner"),a=document.getElementById("submit-text"),u=document.getElementById("placa");u&&u.addEventListener("input",function(t){const e=t.target;e.value=e.value.toUpperCase().replace(/[^A-Z0-9]/g,"")});const g=document.getElementById("tipo"),n=document.getElementById("vehicle-type-preview");g&&n&&g.addEventListener("change",function(t){const o=t.target.value;if(o){const r=`/img_tipo_vehiculo/${o==="Automovil"?"automovil":o}.jpg`;n.setAttribute("src",r),n.setAttribute("alt",`Vista previa de ${o}`),n.onerror=function(){n.setAttribute("src","/img_tipo_vehiculo/automovil.jpg"),n.onerror=null}}else n.setAttribute("src","/img_tipo_vehiculo/automovil.jpg")}),i?.addEventListener("submit",async t=>{t.preventDefault(),s instanceof HTMLButtonElement&&(s.disabled=!0),d?.classList.remove("hidden"),a&&(a.textContent="Registrando..."),window.hideMessages();try{if(!i)throw new Error("Formulario no encontrado");const e=new FormData(i),o=["placa","tipo"];for(const c of o)if(!e.get(c))throw new Error(`El campo ${c} es requerido`);const r=e.get("placa");if(r&&typeof r=="string"&&(r.length<5||r.length>7))throw new Error("La placa debe tener entre 5 y 7 caracteres");const m=e.get("tipo");if(typeof r=="string"&&typeof m=="string"){const c=await f(r,m);window.showSuccessMessage("¡Vehículo registrado exitosamente!")}else throw new Error("Los valores de placa y tipo deben ser cadenas de texto");i.reset(),setTimeout(()=>{window.location.href="/user/dashboard"},2e3)}catch(e){console.error("Error registering vehicle:",e);const o=e instanceof Error?e.message:"Error desconocido";o&&(o.includes("sesión")||o.includes("autenticación")||o.includes("token"))?(window.showErrorMessage("Tu sesión ha expirado. Serás redirigido para iniciar sesión nuevamente."),setTimeout(()=>{h.getState().logout(),window.location.href="/login?session=expired"},2e3)):window.showErrorMessage(e instanceof Error?e.message:"Error al registrar el vehículo. Por favor, intenta de nuevo.")}finally{s instanceof HTMLButtonElement&&(s.disabled=!1),d?.classList.add("hidden"),a&&(a.textContent="Registrar Vehículo")}})});
